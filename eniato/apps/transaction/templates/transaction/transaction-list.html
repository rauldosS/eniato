{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container px-3 py-3 pt-md-5 pb-md-4 mx-auto">
    {% now "d" as current_day %}
    {% now "F" as current_month %}
    {% now "Y" as current_year %}

    <div class="d-flex d-flex justify-content-evenly align-items-center month">
        <div class="">
            <i class="bi bi-chevron-left fs-5"></i>
        </div>
        <h5 class="text-center">Maio</h5>
        <div class="">
            <i class="bi bi-chevron-right fs-5"></i>
        </div>
    </div>

    {% regroup transactions by transaction_date|date:"F, Y" as transactions_group_month %}
    {% for month in transactions_group_month %}
    <div>
        <h4 class="text-center mb-3">{{ month.grouper|slice:":-6" }} {{ month.grouper|slice:"-4:" }}</h4>
        <div>
            {% regroup month.list by transaction_date|date:"d, D" as transaction_group_date %}
            {% for date in transaction_group_date %}
            <div class="d-flex mb-2">
                <div class="d-flex flex-column text-center me-3">
                    <div class="fw-bold {% if date.grouper|slice:":-5" == current_day and month.grouper|slice:":-6" == current_month and month.grouper|slice:"-4:" == current_year %}text-primary{% else %}text-black-50{% endif %}">
                        {{ date.grouper|slugify|slice:"-3:" }}
                    </div>
                    <div class="{% if date.grouper|slice:":-5" == current_day and month.grouper|slice:":-6" == current_month and month.grouper|slice:"-4:" == current_year %}fs-4 bg-primary text-white rounded-circle d-flex justify-content-center align-items-center{% else %}fs-4{% endif %}" style="width: 40px; height: 40px">{{ date.grouper|slice:":-5" }}</div>
                </div>
                <hr>
                <div class="ms-2 w-100">
                    {% for transaction in date.list %}
                        <div class="align-self-baseline bg-white rounded-2 shadow border-top rounded-4 ps-2 ms-2 mb-3 {% if transaction.category.category_type == 'expense' %}border-left-danger{% else %}border-left-success{% endif %}">
                            <div class="d-flex mt-2 me-3">
                                <img class='logo-financial-institution-sm ms-2' src="{{ transaction.display_account_logo }}" style="margin-top: 12px;">
                                <div class="p-0 pt-2 ms-2 fs-4">{{ transaction.description }}</div>
                                <div class="p-2 ms-auto fs-5">{{ transaction.display_value }}</div>
                            </div>
                            <div class="d-flex pb-2 me-3 ms-2">
                                <div class="p-2 ms-4 text-muted">
                                    <i class="bi {{ transaction.category.icon }}" style="font-size: 16px;"></i>
                                    {{ transaction.category.name }}
                                </div>
                                <div class="ms-auto fs-4 btn-group" role="group">
                                    {% if transaction.status %}
                                        <button type="button" class="btn" data-toggle="tooltip" data-bs-placement="top" title="Marcar como pendente">
                                            <i class="bi bi-x-circle text-danger"></i>
                                        </button>
                                    {% else %}
                                        <button type="button" class="btn fs-5" data-toggle="tooltip" data-bs-placement="top" title="Efetivar">
                                            <i class="bi bi-check2-circle text-success"></i>
                                        </button>
                                    {% endif %}
                                    <button type="button" class="btn" data-toggle="tooltip" data-bs-placement="top" title="Editar">
                                        <i class="bi bi-pencil-square text-primary"></i>
                                    </button>
                                    <button type="button" class="btn" data-toggle="tooltip" data-bs-placement="top" title="Deletar">
                                        <i class="bi bi-trash3 text-danger"></i>
                                    </button>
                                    <button type="button" class="btn" data-toggle="tooltip" data-bs-placement="top" title="Anexar arquivo">
                                        <i class="bi bi-paperclip text-muted"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <div class="fab" data-bs-backdrop="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
        </svg>
    </div>

    <div class="box">
        <a href="{% url 'transaction:create' 'receita' %}" class="btn btn-success item fs-5 mb-2 item1 active-tooltip">
            <span class="me-2 fs-6">Receita</span>
            <i class="bi bi-graph-up-arrow"></i>
        </a>
        <a href="{% url 'transaction:create' 'despesa' %}" class="btn btn-danger item fs-5 mb-2 item2 active-tooltip">
            <span class="me-2 fs-6">Despesa</span>
            <i class="bi bi-graph-down-arrow"></i>
        </a>
        <a href="{% url 'transaction:create' 'credito' %}" class="btn btn-secondary text-white item fs-5 mb-2 item3 active-tooltip">
            <span class="me-2 fs-6">Crédito</span>
            <i class="bi bi-credit-card"></i>
        </a>
        <a href="{% url 'transaction:create' 'transferencia' %}" class="btn btn-primary item fs-5 mb-2 item4 active-tooltip">
            <span class="me-2 fs-6">Transferência</span>
            <i class="bi bi-repeat"></i>
        </a>
    </div>
</div>
{% endblock %}

{% block custom_css %}
<style>
    .fab {
        position: fixed;
        bottom: 32px;
        right: 32px;
        border-radius: 12px;
        width: 60px;
        height: 60px;
        background-color: #356b8d;
        box-shadow: 1px 2px 4px grey;
        z-index: 1060;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #FFF;
    }

    .fab:hover {
        cursor: pointer;
    }

    .fab svg {
        transition: .4s
    }

    .box {
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: fixed;
        height: 220px;
        bottom: 100px;
        right: 5px;
        transition-delay: .3s;
        width: 80px;
        visibility: hidden;
        opacity: 0;
        transition: visibility 0s, opacity 0.5s linear;
        z-index: 1060;
    }
    
    .item {
        overflow: hidden;
        border-radius: 12px;
        transition: .4s ease-in;
        width: 156px;
        height: 44px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        box-shadow: 1px 1px 3px grey;
        position: relative;
        right: 100px;
    }

    .box-active {
        visibility: visible;
        opacity: 1;
    }

    .fab-active svg {
        transform: rotate(225deg);
    }
</style>
{% endblock %}

{% block js %}
<script>
    document.querySelector('.fab').addEventListener('click', () => {
        document.querySelector('.box').classList.toggle('box-active')
        document.querySelector('.fab').classList.toggle('fab-active')
        document.querySelector('.modal-backdrop').classList.toggle('show')
        document.querySelector('.modal-backdrop').classList.toggle('d-none')
    })
</script>
{% endblock %}
